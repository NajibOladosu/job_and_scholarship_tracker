{% extends 'base.html' %}
{% load static %}

{% block title %}Delete Application - AppTracker{% endblock %}

{% block extra_css %}
<style>
    .delete-container {
        max-width: 700px;
        margin: 0 auto;
        padding-top: 3rem;
    }

    .warning-icon {
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 2rem;
        box-shadow: 0 8px 24px rgba(239, 68, 68, 0.3);
        animation: shake 0.5s ease-in-out;
    }

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }

    .delete-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        border: 2px solid #fecaca;
    }

    .card-header-danger {
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        border-bottom: 2px solid #ef4444;
    }

    .info-box {
        background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        border-left: 4px solid #6b7280;
        border-radius: 8px;
        padding: 1.5rem;
    }

    .warning-box {
        background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
        border-left: 4px solid #f59e0b;
        border-radius: 8px;
        padding: 1.5rem;
    }

    .danger-list {
        list-style: none;
        padding: 0;
    }

    .danger-list li {
        padding: 0.75rem 0;
        border-bottom: 1px solid #fee2e2;
        display: flex;
        align-items: center;
    }

    .danger-list li:last-child {
        border-bottom: none;
    }

    .danger-list li i {
        margin-right: 0.75rem;
        color: #ef4444;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="delete-container">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{% url 'tracker:dashboard' %}" class="text-decoration-none">
                        <i class="bi bi-house-door me-1"></i>Dashboard
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a href="{% url 'tracker:application_detail' object.pk %}" class="text-decoration-none">
                        {{ object.title|truncatewords:5 }}
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Delete Confirmation</li>
            </ol>
        </nav>

        <!-- Warning Icon -->
        <div class="warning-icon">
            <i class="bi bi-exclamation-triangle-fill text-danger" style="font-size: 3rem;"></i>
        </div>

        <!-- Main Card -->
        <div class="delete-card">
            <div class="card-header-danger py-3 px-4">
                <h3 class="fw-bold mb-0 text-danger">
                    <i class="bi bi-shield-fill-exclamation me-2"></i>
                    Confirm Deletion
                </h3>
            </div>

            <div class="card-body p-4 p-md-5">
                <!-- Application Info -->
                <div class="info-box mb-4">
                    <h5 class="fw-bold mb-3">
                        <i class="bi bi-info-circle-fill text-primary me-2"></i>
                        Application Details
                    </h5>
                    <dl class="row mb-0">
                        <dt class="col-sm-4">Title:</dt>
                        <dd class="col-sm-8 fw-bold">{{ object.title }}</dd>

                        <dt class="col-sm-4">Company:</dt>
                        <dd class="col-sm-8">{{ object.company_or_institution }}</dd>

                        <dt class="col-sm-4">Type:</dt>
                        <dd class="col-sm-8">
                            <span class="badge bg-primary">{{ object.get_application_type_display }}</span>
                        </dd>

                        <dt class="col-sm-4">Status:</dt>
                        <dd class="col-sm-8">
                            {% if object.status == 'draft' %}
                                <span class="badge bg-secondary">{{ object.get_status_display }}</span>
                            {% elif object.status == 'submitted' %}
                                <span class="badge bg-info">{{ object.get_status_display }}</span>
                            {% elif object.status == 'in_review' %}
                                <span class="badge bg-warning text-dark">{{ object.get_status_display }}</span>
                            {% elif object.status == 'interview' %}
                                <span class="badge" style="background: #8b5cf6;">{{ object.get_status_display }}</span>
                            {% elif object.status == 'offer' %}
                                <span class="badge bg-success">{{ object.get_status_display }}</span>
                            {% elif object.status == 'rejected' %}
                                <span class="badge bg-danger">{{ object.get_status_display }}</span>
                            {% endif %}
                        </dd>

                        {% if object.deadline %}
                        <dt class="col-sm-4">Deadline:</dt>
                        <dd class="col-sm-8">{{ object.deadline|date:"M d, Y g:i A" }}</dd>
                        {% endif %}

                        <dt class="col-sm-4">Created:</dt>
                        <dd class="col-sm-8 mb-0">{{ object.created_at|date:"M d, Y" }}</dd>
                    </dl>
                </div>

                <!-- Warning Message -->
                <div class="warning-box mb-4">
                    <h5 class="fw-bold mb-3 text-warning">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        Warning: This Action Cannot Be Undone
                    </h5>
                    <p class="mb-3">
                        Are you absolutely sure you want to delete this application? This will permanently remove:
                    </p>

                    <ul class="danger-list mb-0">
                        <li>
                            <i class="bi bi-x-circle-fill"></i>
                            <span><strong>{{ object.questions.count }}</strong> question{{ object.questions.count|pluralize }} associated with this application</span>
                        </li>
                        <li>
                            <i class="bi bi-x-circle-fill"></i>
                            <span><strong>All AI-generated responses</strong> for these questions</span>
                        </li>
                        <li>
                            <i class="bi bi-x-circle-fill"></i>
                            <span><strong>Status history</strong> and timeline data</span>
                        </li>
                        <li>
                            <i class="bi bi-x-circle-fill"></i>
                            <span><strong>All notes and metadata</strong> related to this application</span>
                        </li>
                    </ul>
                </div>

                <!-- Confirmation Input -->
                <div class="alert alert-danger d-flex align-items-start mb-4" role="alert">
                    <i class="bi bi-shield-fill-x me-3" style="font-size: 1.5rem;"></i>
                    <div>
                        <strong>Data Loss Warning:</strong>
                        <p class="mb-0">This action is permanent and cannot be reversed. All data will be immediately and permanently deleted from our system.</p>
                    </div>
                </div>

                <!-- Action Buttons -->
                <form method="post" id="delete-form">
                    {% csrf_token %}
                    <div class="d-flex gap-3 justify-content-between">
                        <a href="{% url 'tracker:application_detail' object.pk %}" class="btn btn-lg btn-outline-secondary flex-grow-1">
                            <i class="bi bi-arrow-left me-2"></i>
                            Cancel, Keep Application
                        </a>
                        <button type="submit" class="btn btn-lg btn-danger flex-grow-1" id="delete-btn">
                            <i class="bi bi-trash-fill me-2"></i>
                            Yes, Delete Permanently
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Alternative Actions -->
        <div class="text-center mt-4">
            <p class="text-muted mb-2">Not ready to delete?</p>
            <div class="d-flex gap-2 justify-content-center flex-wrap">
                <a href="{% url 'tracker:application_edit' object.pk %}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-pencil me-1"></i>
                    Edit Application
                </a>
                <a href="{% url 'tracker:dashboard' %}" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-house-door me-1"></i>
                    Back to Dashboard
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const deleteForm = document.getElementById('delete-form');
    const deleteBtn = document.getElementById('delete-btn');

    // Add confirmation dialog
    deleteForm.addEventListener('submit', function(e) {
        e.preventDefault();

        // Double confirmation for destructive action
        const confirmText = 'DELETE';
        const userInput = prompt(
            'This is a destructive action. To confirm deletion, please type "DELETE" (in capital letters) below:'
        );

        if (userInput === confirmText) {
            // Update button to show processing
            deleteBtn.disabled = true;
            deleteBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Deleting...';

            // Submit the form
            deleteForm.submit();
        } else if (userInput !== null) {
            // User provided wrong confirmation
            alert('Deletion cancelled. The confirmation text did not match.');
        }
        // If userInput is null, user clicked Cancel - do nothing
    });
});
</script>
{% endblock %}
